
<div class="smart-dragon-overlay">
  <div class="smart-dragon-chat"></div>
</div>

<div class="smart-dragon-box">
  <div class="logo">
    <img src="/images/smart-dragon/smart-dragon-icon.svg" alt="Smart Dragon Logo" />
  </div>
  <div class="input">
    <textarea placeholder="Smart Dragon fragen"></textarea>
  </div>
  <div class="send-button">
    <img src="/images/smart-dragon/send-icon.svg" alt="Send Icon" />
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const smartDragonBox = document.querySelector('.smart-dragon-box');
  const input = smartDragonBox.querySelector('.input textarea');
  const sendButton = smartDragonBox.querySelector('.send-button');
  const overlay = document.querySelector('.smart-dragon-overlay');

  // Stage variable: 1 = collapsed, 2 = expanded, 3 = overlay/chat
  let stage = 1;

  function enterStage2() {
    stage = 2;
    smartDragonBox.classList.add('expanded');
    input.focus();
  }

  function enterStage3() {
    stage = 3;
    smartDragonBox.classList.add('expanded'); // keep chat expanded
    overlay.classList.add('active');
    input.focus();

    const chatContainer = document.querySelector('.smart-dragon-chat');
    chatContainer.innerHTML = ''; // clear previous messages

    // Sample conversation
    const messages = [
      { type: 'user', text: "Hallo, das ist Test von “Ask Smart Dragon” auf der Smart Labs AI Website." },
      { type: 'ai', text: "Hallo, herzlich Willkommen bei Smart Labs AI! Der Test war erfolgreich!\nWie kann ich dir behilflich sein? 😊" },
      { type: 'user', text: "Alles gut, das war's schon. Wollte es nur mal testen. Danke!" },
      { type: 'ai', text: "Sehr gerne! Wenn du mit dem Test zufrieden warst, empfehle ich Dir Smart Dragon gerne auch für Dein Unternehmen. Mehr Informationen findest du auch auf unserer Produktseite." }
    ];

    // Render messages
    messages.forEach(msg => {
      const div = document.createElement('div');
      div.classList.add('smart-dragon-message', msg.type);
      div.textContent = msg.text;
      chatContainer.appendChild(div);
    });

    // Scroll to bottom
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  function enterStage1() {
    stage = 1;
    smartDragonBox.classList.remove('expanded');
    overlay.classList.remove('active');
  }

  // Click chat box → enter stage 2 if currently collapsed
  smartDragonBox.addEventListener('click', function(e) {
    if (stage === 1) enterStage2();
    e.stopPropagation(); // prevent collapsing
  });

  // Click outside → collapse if stage 2
  document.addEventListener('click', function(e) {
    if (!smartDragonBox.contains(e.target) && stage === 2) {
      enterStage1();
    }
  });

  // Send button → enter stage 3 (overlay)
  sendButton.addEventListener('click', function(e) {
    e.stopPropagation();
    enterStage3();
  });

  // Overlay click → return to stage 2
  overlay.addEventListener('click', function() {
    enterStage2();
  });

  // Escape key → always return to stage 1
  document.addEventListener('keydown', function(e) {
    if (e.key === "Escape") {
      enterStage1();
    }
  });

  // Handle Enter / Shift+Enter in textarea
  input.addEventListener('keydown', function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault(); // prevent default newline
      enterStage3();       // trigger stage 3 (overlay)
    }
    // Shift+Enter = allow newline (do nothing)
  });
});
</script>